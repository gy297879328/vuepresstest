<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>并发编程的优缺点 | 小光头的java日记</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/vuepresstest/assets/img/favicon.ico">
    <meta name="description" content="小光头的java日记,java笔记,java面试">
    <meta name="Keywords" content="小光头的java日记,java笔记,java面试">
    
    <link rel="preload" href="/vuepresstest/assets/css/0.styles.d89a2b9b.css" as="style"><link rel="preload" href="/vuepresstest/assets/js/app.9ebcd2ef.js" as="script"><link rel="preload" href="/vuepresstest/assets/js/2.dff95b5d.js" as="script"><link rel="preload" href="/vuepresstest/assets/js/14.ebfbc0a9.js" as="script"><link rel="prefetch" href="/vuepresstest/assets/js/10.fa960f2e.js"><link rel="prefetch" href="/vuepresstest/assets/js/11.7ee73b76.js"><link rel="prefetch" href="/vuepresstest/assets/js/12.f7f3976f.js"><link rel="prefetch" href="/vuepresstest/assets/js/13.b1d5e81e.js"><link rel="prefetch" href="/vuepresstest/assets/js/3.3cda577a.js"><link rel="prefetch" href="/vuepresstest/assets/js/4.472f1283.js"><link rel="prefetch" href="/vuepresstest/assets/js/5.5a3110e6.js"><link rel="prefetch" href="/vuepresstest/assets/js/6.d6470b59.js"><link rel="prefetch" href="/vuepresstest/assets/js/7.a82312ba.js"><link rel="prefetch" href="/vuepresstest/assets/js/8.cc86cea1.js"><link rel="prefetch" href="/vuepresstest/assets/js/9.d743d330.js">
    <link rel="stylesheet" href="/vuepresstest/assets/css/0.styles.d89a2b9b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepresstest/" class="home-link router-link-active"><img src="/vuepresstest/assets/img/logo.png" alt="小光头的java日记" class="logo"> <span class="site-name can-hide">小光头的java日记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepresstest/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vuepresstest/about/" class="nav-link">
  about
</a></div><div class="nav-item"><a href="/vuepresstest/javabase/" class="nav-link">
  javabase
</a></div><div class="nav-item"><a href="/vuepresstest/morethread/" class="nav-link router-link-active">
  多线程基础
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分级目录" class="dropdown-title"><span class="title">分级目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="分级目录" class="mobile-dropdown-title"><span class="title">分级目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Group1
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepresstest/about/" class="nav-link">
  about
</a></li><li class="dropdown-subitem"><a href="/vuepresstest/javabase/" class="nav-link">
  javabase
</a></li></ul></li><li class="dropdown-item"><h4>
          Group2
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepresstest/about/" class="nav-link">
  about
</a></li><li class="dropdown-subitem"><a href="/vuepresstest/javabase/" class="nav-link">
  javabase
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepresstest/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vuepresstest/about/" class="nav-link">
  about
</a></div><div class="nav-item"><a href="/vuepresstest/javabase/" class="nav-link">
  javabase
</a></div><div class="nav-item"><a href="/vuepresstest/morethread/" class="nav-link router-link-active">
  多线程基础
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分级目录" class="dropdown-title"><span class="title">分级目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="分级目录" class="mobile-dropdown-title"><span class="title">分级目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Group1
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepresstest/about/" class="nav-link">
  about
</a></li><li class="dropdown-subitem"><a href="/vuepresstest/javabase/" class="nav-link">
  javabase
</a></li></ul></li><li class="dropdown-item"><h4>
          Group2
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepresstest/about/" class="nav-link">
  about
</a></li><li class="dropdown-subitem"><a href="/vuepresstest/javabase/" class="nav-link">
  javabase
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vuepresstest/morethread/" aria-current="page" class="sidebar-link">多线程</a></li><li><a href="/vuepresstest/morethread/bf.html" aria-current="page" class="active sidebar-link">并发编程的优缺点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepresstest/morethread/bf.html#_1-为什么要用到并发" class="sidebar-link">1. 为什么要用到并发</a></li><li class="sidebar-sub-header"><a href="/vuepresstest/morethread/bf.html#_2-并发编程有哪些缺点" class="sidebar-link">2. 并发编程有哪些缺点</a></li><li class="sidebar-sub-header"><a href="/vuepresstest/morethread/bf.html#可见性-cpu缓存引起" class="sidebar-link">可见性: CPU缓存引起</a></li><li class="sidebar-sub-header"><a href="/vuepresstest/morethread/bf.html#原子性-分时复用引起" class="sidebar-link">原子性: 分时复用引起</a></li><li class="sidebar-sub-header"><a href="/vuepresstest/morethread/bf.html#有序性-重排序引起" class="sidebar-link">有序性: 重排序引起</a></li><li class="sidebar-sub-header"><a href="/vuepresstest/morethread/bf.html#并发与并行" class="sidebar-link">并发与并行</a></li></ul></li><li><a href="/vuepresstest/morethread/test1.html" class="sidebar-link">多线程</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="并发编程的优缺点"><a href="#并发编程的优缺点" class="header-anchor">#</a> 并发编程的优缺点</h1> <h2 id="_1-为什么要用到并发"><a href="#_1-为什么要用到并发" class="header-anchor">#</a> 1. 为什么要用到并发</h2> <p>多核的CPU的背景下，催生了并发编程的趋势，通过<strong>并发编程的形式可以将多核CPU的计算能力发挥到极致，性能得到提升</strong></p> <p><strong>面对复杂业务模型，并行程序会比串行程序更适应业务需求，而并发编程更能吻合这种业务拆分</strong></p> <h2 id="_2-并发编程有哪些缺点"><a href="#_2-并发编程有哪些缺点" class="header-anchor">#</a> 2. 并发编程有哪些缺点</h2> <h3 id="_2-1-频繁的上下文切换"><a href="#_2-1-频繁的上下文切换" class="header-anchor">#</a> 2.1 频繁的上下文切换</h3> <p>时间片是CPU分配给各个线程的时间，因为时间非常短，所以<strong>CPU不断通过切换线程</strong>，让我们觉得多个线程是同时执行的，时间片一般是几十毫秒。而每次切换时，需要保存当前的状态起来，以便能够进行恢复先前状态，而这个切换时非常损耗性能，<strong>过于频繁反而无法发挥出多线程编程的优势</strong>。<strong>通常减少上下文切换可以采用无锁并发编程，CAS算法，使用最少的线程和使用协程</strong>。</p> <h3 id="_2-2-线程安全"><a href="#_2-2-线程安全" class="header-anchor">#</a> 2.2 线程安全</h3> <p>多线程编程中最难以把握的就是<strong>临界区线程安全问题</strong>，稍微不注意就会出现死锁的情况，一旦产生死锁就会造成系统功能不可用。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLockDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> resource_a <span class="token operator">=</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> resource_b <span class="token operator">=</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">deadLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">deadLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> threadA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>resource_a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;get resource a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>resource_b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;get resource b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> threadB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>resource_b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;get resource b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>resource_a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;get resource a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadA<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadB<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通常可以用如下方式<strong>避免死锁</strong>的情况</p> <ol><li>避免一个线程同时获得多个锁；</li> <li>避免一个线程在锁内部占有多个资源，尽量保证每个锁只占用一个资源</li> <li>尝试使用定时锁，使用lock.tryLock(timeOut)，当超时等待时当前线程不会阻塞；</li> <li>对于数据库锁，加锁和解锁必须在一个数据库连接里，否则会出现解锁失败的情况</li></ol> <h1 id="并发三要素"><a href="#并发三要素" class="header-anchor">#</a> 并发三要素</h1> <h2 id="可见性-cpu缓存引起"><a href="#可见性-cpu缓存引起" class="header-anchor">#</a> 可见性: CPU缓存引起</h2> <p>可见性：当多个线程访问同一个变量时，如果其中一个线程对其作了修改，其他线程能立即获取到最新的值。</p> <h2 id="原子性-分时复用引起"><a href="#原子性-分时复用引起" class="header-anchor">#</a> 原子性: 分时复用引起</h2> <p>原子性：即一个操作或者多个操作 要么全部执行并且执行的过程不会被任何因素打断，要么就都不执行</p> <h2 id="有序性-重排序引起"><a href="#有序性-重排序引起" class="header-anchor">#</a> 有序性: 重排序引起</h2> <p>程序执行的顺序按照代码的先后顺序执行。（处理器可能会对指令进行重排序）</p> <p>在执行程序时为了提高性能，编译器和处理器常常会对指令做重排序。<strong>重排序分三种类型</strong>：</p> <ul><li>编译器优化的重排序。编译器在不改变单线程程序语义的前提下，可以重新安排语句的执行顺序。</li> <li>指令级并行的重排序。现代处理器采用了指令级并行技术（Instruction-Level Parallelism， ILP）来将多条指令重叠执行。如果不存在数据依赖性，处理器可以改变语句对应机器指令的执行顺序。</li> <li>内存系统的重排序。由于处理器使用缓存和读 / 写缓冲区，这使得加载和存储操作看上去可能是在乱序执行。</li></ul> <h1 id="并发核心概念"><a href="#并发核心概念" class="header-anchor">#</a> 并发核心概念</h1> <h2 id="并发与并行"><a href="#并发与并行" class="header-anchor">#</a> 并发与并行</h2> <p>在单个处理器上采用单核执行多个任务即为并发。在这种情况下，操作系统的任务调度程序会很快</p> <p>从一个任务切换到另一个任务，因此看起来所有的任务都是同时运行的。</p> <p>同一时间内在不同计算机、处理器或处理器核心上同时运行多个任务，就是所谓的“并行”。</p> <p>另一个关于并发的定义是，在系统上同时运行多个任务（不同的任务）就是并发。而另一个关于并</p> <p>行的定义是：同时在某个数据集的不同部分上运行同一任务的不同实例就是并行。</p> <p>关于并行的最后一个定义是，系统中同时运行了多个任务。关于并发的最后一个定义是，一种解释</p> <p>程序员将任务和它们对共享资源的访问同步的不同技术和机制的方法。</p> <p>这两个概念非常相似，而且这种相似性随着多核处理器的发展也在不断增强。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepresstest/morethread/" class="prev router-link-active">
        多线程
      </a></span> <span class="next"><a href="/vuepresstest/morethread/test1.html">
        多线程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepresstest/assets/js/app.9ebcd2ef.js" defer></script><script src="/vuepresstest/assets/js/2.dff95b5d.js" defer></script><script src="/vuepresstest/assets/js/14.ebfbc0a9.js" defer></script>
  </body>
</html>
